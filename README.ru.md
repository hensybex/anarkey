# üîë AnarKey

> **–°–≤–æ–±–æ–¥–∞ –æ—Ç –∞–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!**

AnarKey ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å –æ–¥–Ω–æ–π —Ü–µ–ª—å—é: –¥–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –ø–æ–ª–Ω—É—é –≤–ª–∞—Å—Ç—å –Ω–∞–¥ —Ç–æ–∫–µ–Ω–∞–º–∏, —Ä–æ–ª—è–º–∏ –∏ –¥–æ—Å—Ç—É–ø–∞–º–∏ ‚Äî –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –≥—Ä–æ–º–æ–∑–¥–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π.

## üè¥ –§–∏–ª–æ—Å–æ—Ñ–∏—è AnarKey

- **–ú–∏–Ω–∏–º–∞–ª–∏–∑–º**: –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ.
- **–ì–∏–±–∫–æ—Å—Ç—å**: —Ä–∞—Å—à–∏—Ä—è–π –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –±–µ–∑ –±–æ–ª–∏.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –Ω–∞–¥—ë–∂–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã.
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –Ω–∏–∫–∞–∫–æ–π –º–∞–≥–∏–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–æ–¥.

## ‚öôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- JWT —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- Refresh-—Ç–æ–∫–µ–Ω—ã (—Ä–æ—Ç–∞—Ü–∏—è –∏ –æ—Ç–∑—ã–≤).
- –ü—Ä–æ—Å—Ç–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ RBAC.
- –ì–æ—Ç–æ–≤—ã–µ middleware –¥–ª—è Gin (–ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –¥—Ä—É–≥–∏–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏).
- –õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–≤–æ–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
- –ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.
- –•—É–∫–∏ —Å–æ–±—ã—Ç–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π).

## üíª –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
go get github.com/hensybex/anarkey
```

üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```go
package main

import (
    "time"
    "github.com/gin-gonic/gin"
    "github.com/hensybex/anarkey/authcore"
    "github.com/hensybex/anarkey/middleware/authgin"
)

func main() {
    auth, err := authcore.NewWithConfig(authcore.Config{
        Issuer:        "my-app",
        Audience:      "my-api",
        TokenSecret:   "–º–µ–Ω—è–π-–≤-–ø—Ä–æ–¥–µ", // Env vars –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ!
        TokenLifetime: 15 * time.Minute,
    })
    if err != nil {
        panic("–û—à–∏–±–∫–∞ AnarKey: " + err.Error())
    }

    r := gin.Default()
    authMw := authgin.New(auth)

    r.POST("/login", func(c *gin.Context) {
        username, password := c.PostForm("username"), c.PostForm("password")

        if username == "admin" && password == "password" {
            claims := map[string]interface{}{
                "user_id": "123",
                "roles":   []string{"admin", "user"},
            }

            at, rt, err := auth.GenerateTokens(claims)
            if err != nil {
                c.JSON(500, gin.H{"error": "–ù–µ —Å–º–æ–≥ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω—ã"})
                return
            }

            c.JSON(200, gin.H{"access_token": at, "refresh_token": rt, "token_type": "Bearer"})
        } else {
            c.JSON(401, gin.H{"error": "–ù–µ–≤–µ—Ä–Ω—ã–µ –∫—Ä–µ–¥—ã"})
        }
    })

    r.POST("/refresh", func(c *gin.Context) {
        rt := c.PostForm("refresh_token")
        at, rtNew, err := auth.RefreshTokens(rt)
        if err != nil {
            c.JSON(401, gin.H{"error": "–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π refresh-—Ç–æ–∫–µ–Ω"})
            return
        }

        c.JSON(200, gin.H{"access_token": at, "refresh_token": rtNew, "token_type": "Bearer"})
    })

    protected := r.Group("/")
    protected.Use(authMw.RequireAuthentication())
    protected.GET("/profile", func(c *gin.Context) {
        user, _ := authgin.UserFromGinContext(c, auth.Config.TokenContextKey)
        c.JSON(200, gin.H{"user_id": user.GetClaim("user_id"), "roles": user.GetClaim("roles")})
    })

    admin := r.Group("/")
    admin.Use(authMw.RequireAuthentication(), authMw.RequireRole("admin"))
    admin.GET("/admin", func(c *gin.Context) {
        c.JSON(200, gin.H{"message": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, admin!"})
    })

    r.Run(":8080")
}
```

üîß –í–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```go
// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
auth, err := authcore.New()

// –ß–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª YAML
auth, err := authcore.NewFromFile("./config.yaml")

// –ß–µ—Ä–µ–∑ Viper
v := viper.New()
v.SetConfigFile("./config.yaml")
v.ReadInConfig()
auth, err := authcore.NewFromViper(v)
```

üîê –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

    –ò—Å–ø–æ–ª—å–∑—É–π —Å–∏–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –∏ secure storage.

    RS256/ES256 ‚Äî –≤ –ø—Ä–æ–¥–∞–∫—à–Ω.

    –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —é–∑–µ—Ä–æ–≤ ‚Äî –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Ç–≤–æ–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

üìú –õ–∏—Ü–µ–Ω–∑–∏—è
MIT